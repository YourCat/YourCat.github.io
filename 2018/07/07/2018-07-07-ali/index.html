

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="iHan">
  <meta name="keywords" content="">
  
  <title>Ali Link Develop 入门学习 - iHan</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>iHan's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Ali Link Develop 入门学习">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2018-07-07 13:00" pubdate>
        2018年7月7日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.7k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      35
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      
<meta name="referrer" content="no-referrer" />
<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Ali Link Develop 入门学习</h1>
            
            <div class="markdown-body">
              <h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p><strong>Link Develop</strong></p>
<p>何为Link Develop？官方文档中这样介绍：Link Develop是阿里云针对物联网领域提供的端到端一站式开发平台，可覆盖各个物联网行业应用场景，主要解决物联网开发领域开发链路长、技术栈复杂、协同成本高、方案移植困难的问题，提供了从硬件设备、模组、数据、服务API、Web应用开发到移动APP开发全链路的开发流程、框架／引擎和调试工具，并可将成熟的开发产出物对接阿里云云市场进行售卖，为开发者实现商业收益。<br>简言之，它是阿里专门为物联网开发推出的一项技术，一个可以供大家使用的开发平台。</p>
<p>Link Develop 架构图：</p>
<p><img src="/img/LinkDevelop.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>下面简单复盘一下设备端开发和前端应用开发两个入门案例。</p>
<h4 id="设备端开发"><a href="#设备端开发" class="headerlink" title="设备端开发"></a>设备端开发</h4><p>首先，需要 创建产品和测试设备  </p>
<p><strong>创建RGB智能灯产品</strong><br>从项目控制台左侧的设备菜单项里找到“产品开发”，点击进入并点击“立即创建产品”。<br><img src="/img/LD1.png" srcset="/img/loading.gif" lazyload alt="img"><br>按下图填写表单，所属分类选择“智能生活/电工照明/灯”，节点类型选择“设备”，通讯网络选择“Wi-Fi”，数据格式选择“Alink”，然后点“提交”后点击“进入开发”按钮。<br><img src="/img/LD2.png" srcset="/img/loading.gif" lazyload alt="img"><br>创建好产品后，我们发现产品界面上已经有了故障和主灯开关这两个设备的标准功能定义。产品功能定义使用的是 ICA 联盟 定义的标准产品功能规范，用来描述设备能做什么有什么能力。我们开发的产品原型是 RGB 小灯，所以我们还需要添加一个 RGB 调色的功能定义。<br><img src="/img/LD3.png" srcset="/img/loading.gif" lazyload alt="img"><br>点击标准功能一栏右侧的“新增”按钮。在弹出的“新增可选功能”对话框左侧列表中，找到 RGB 调色功能并单击进行选择，然后点击“确定”。<br><img src="/img/LD4.png" srcset="/img/loading.gif" lazyload alt="img"><br>在标准功能定义里就有了 RGB调色的功能属性。<br><img src="/img/LD5.png" srcset="/img/loading.gif" lazyload alt="img"><br>有了开关和 RGB 调色的功能，我们的 RGB 全彩灯产品就定义好了，这台灯有什么功能跟能做什么已经描述清楚了。</p>
<p>产品功能定义好了之后，我们就可以申请测试设备的激活凭证，设备的激活凭证就像设备连接到云端的 id 和密码，设备有了 id 和密码，才能通过云端的身份鉴权连接到云端。</p>
<p><strong>创建测试设备</strong><br>我们从“功能定义”的 Tab 切换到“设备开发”的 Tab。</p>
<p>点击“设备列表”一栏右侧的“新增测试设备”按钮。<br><img src="/img/LD6.png" srcset="/img/loading.gif" lazyload alt="img"><br>在弹出的“新增测试设备”对话框中直接点击“确定”，我们就可以得到一个测试设备的激活凭证。激活凭证是包括 ProductKey、DeviceName 和 DeviceSecret（注意是 DeviceSercet） 的一个三元组，用来进行设备与云端的连接和激活，其中 DeviceSecret 是最重要字段，也就是设备的密码，需要妥善保存。<br><img src="/img/LD7.png" srcset="/img/loading.gif" lazyload alt="img"><br>这时候看看设备列表当中已经有了一个未激活的设备：<br><img src="/img/LD8.png" srcset="/img/loading.gif" lazyload alt="img"><br>下一步我们要使用创建的设备激活凭证将设备连接到云端进行激活。</p>
<p>方案四：基于 Web Device 虚拟设备</p>
<blockquote>
<p>Web Device 是用来在浏览器中进行设备快速模拟的工具，此方案的优势是不需要依赖其他硬件和编程工具，只要使用浏览器打开一个 URL，就&gt;能实现设备连接、数据上下行通信模拟。开始前请确保完成了产品和测试设备创建。</p>
</blockquote>
<p>在设备列表中打开在线模拟链接：<br><img src="/img/LD9.png" srcset="/img/loading.gif" lazyload alt="img"><br><strong>设备上线</strong><br>点击“设备模拟”新窗口右上角的“上线”按钮，将设备上线：<br><img src="/img/LD10.png" srcset="/img/loading.gif" lazyload alt="img"><br>可以看到设备已上线：<br><img src="/img/LD11.png" srcset="/img/loading.gif" lazyload alt="img"><br><strong>云端下发消息到设备</strong><br>点击模拟设备界面右上角的“在线调试”按钮，打开在线调试页面：<br><img src="/img/LD12.png" srcset="/img/loading.gif" lazyload alt="img"><br>在页面下方的调试功能里选择“RGB调色（RGBColor）”，方法选为“设置”。  </p>
<p>将下方 JSON 编辑器的内容替换成：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;RGBColor&quot;</span>:&#123;<span class="hljs-attr">&quot;Red&quot;</span>:<span class="hljs-number">255</span>,<span class="hljs-attr">&quot;Blue&quot;</span>:<span class="hljs-number">255</span>,<span class="hljs-attr">&quot;Green&quot;</span>:<span class="hljs-number">0</span>&#125;&#125;<br></code></pre></td></tr></table></figure>
<p>然后点击“发送指令”按钮，切换到设备模拟界面上，可以看到，模拟设备收到了云端消息：<br><img src="/img/LD13.png" srcset="/img/loading.gif" lazyload alt="img"><br><strong>设备上报消息到云端</strong><br>将模拟设备的 RGBColor 属性值改成（255,255,0），点击“上报”，在右侧可以看到设备上报属性成功的消息：<br><img src="/img/LD14.png" srcset="/img/loading.gif" lazyload alt="img"><br>云端也收到了设备上报的数据：<br><img src="/img/LD15.png" srcset="/img/loading.gif" lazyload alt="img"><br>自此，我们基于 Web Device 模拟的 RGB 小灯设备端就完成了。在 IoT 应用端开发中，我们可以借助这个虚拟的设备来完成应用端和设备端的联调，用它来模拟 IoT 设备的各种行为，比如连续上报、定时上报等功能。更多关于 Web Device 设备模拟工具的内容请参考它的详细使用文档。</p>
<p>接下来我们可以进入 Web 应用的开发，Link Develop提供了Web前端应用和第三方应用开发能力，前往查看。</p>
<h4 id="前端应用开发"><a href="#前端应用开发" class="headerlink" title="前端应用开发"></a>前端应用开发</h4><p><strong>软件安装</strong><br>安装 Node.js LTS 版本（&gt;=8.9)：<code>https://nodejs.org/zh-cn/</code><br>安装 Ruff SDK：<code>https://ruff.io/zh-cn/docs/download.html</code><br>安装 Web 应用开发工具 Bone Cli：<code>https://bone.aliyun.com/bone-web/bonewebsdk.html?name=zm1rpl</code><br>文本编辑器：<code>VSCode / Sublime / Vim...</code></p>
<p>版本检查：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">-v</span><br>bnpm -v<br>rap -V<br>bone -v<br></code></pre></td></tr></table></figure>
<p>请确认高于或者等于以下版本：<br><img src="/img/LD16.png" srcset="/img/loading.gif" lazyload alt="img"><br><strong>创建应用</strong><br>从项目控制台左侧菜单进入“应用-Web 应用”，点击右上角的“新增应用”按钮。<br><img src="/img/LD17.png" srcset="/img/loading.gif" lazyload alt="img"><br>如图所示填写表单，新建一个托管应用，点击提交进入下一步。<br><img src="/img/LD18.png" srcset="/img/loading.gif" lazyload alt="img"><br>在应用“创建成功”的页面上点击“进入开发”按钮。<br>我们得到了一个 AppKey ，一个 AppSecret 和一个用来访问应用的三级域名。有了 AppKey 和 AppSecret，就能进行应用开发了。<br><img src="/img/LD19.png" srcset="/img/loading.gif" lazyload alt="img"><br><strong>Web 应用编码</strong><br>新建目录，进行项目初始化：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">mkdir</span> linkdevelop-webapp-rgblight<br><span class="hljs-built_in">cd</span> linkdevelop-webapp-rgblight<br>bone init<br></code></pre></td></tr></table></figure>
<p><img src="/img/LD20.png" srcset="/img/loading.gif" lazyload alt="img"><br>安装 @bone/iot-gateway 和 react-color 颜色选择组件：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">bnpm <span class="hljs-selector-tag">i</span> --save <span class="hljs-keyword">@bone</span>/iot-gateway react-color<br></code></pre></td></tr></table></figure>
<p><img src="/img/LD21.png" srcset="/img/loading.gif" lazyload alt="img"><br>修改 app/pages/home/index.js 代码，内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> React, &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; Button, Switch, Form, Grid, Input, Dialog &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@bone/bone-web-ui&#x27;</span>;<br><span class="hljs-keyword">import</span> IotGateway <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@bone/iot-gateway&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; HuePicker &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-color&#x27;</span>;<br><br><span class="hljs-keyword">const</span> Row = Grid.Row;<br><span class="hljs-keyword">const</span> Col = Grid.Col;<br><span class="hljs-keyword">const</span> FormItem = Form.Item;<br><span class="hljs-keyword">const</span> formItemLayout = &#123;<br>  labelCol: &#123;<br>    fixedSpan: <span class="hljs-number">12</span><br>  &#125;,<br>  wrapperCol: &#123;<br>    span: <span class="hljs-number">12</span><br>  &#125;<br>&#125;;<br><span class="hljs-keyword">const</span> insetLayout = &#123;<br>  labelCol: &#123; <span class="hljs-attr">fixedSpan</span>: <span class="hljs-number">4</span> &#125;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">props</span>)</span> &#123;<br>    <span class="hljs-built_in">super</span>(props);<br>    <span class="hljs-built_in">this</span>.state = &#123;<br>      <span class="hljs-keyword">switch</span>: <span class="hljs-literal">false</span>,<br>      color: <span class="hljs-string">&#x27;&#x27;</span>,<br>      <span class="hljs-comment">// 刷新页面不用重复输入</span><br>      productKey: <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&#x27;productKey&#x27;</span>) || <span class="hljs-string">&#x27;&#x27;</span>,<br>      deviceName: <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&#x27;deviceName&#x27;</span>) || <span class="hljs-string">&#x27;&#x27;</span><br>    &#125;;<br>    <span class="hljs-comment">// 获取初始数据</span><br>    <span class="hljs-built_in">this</span>.getProps(<span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> &#123;<br>      <span class="hljs-built_in">this</span>.setState(&#123;<br>        <span class="hljs-keyword">switch</span>: props.LightSwitch === <span class="hljs-number">1</span>,<br>        color: rgbToHex(<br>          props.RGBColor.Red,<br>          props.RGBColor.Green,<br>          props.RGBColor.Blue<br>        )<br>      &#125;);<br>    &#125;);<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-title">getProps</span>(<span class="hljs-params">cb</span>)</span> &#123;<br>    IotGateway.post(&#123;<br>      url: <span class="hljs-string">&#x27;https://api.link.aliyun.com/thing/device/status/query&#x27;</span>,<br>      apiVer: <span class="hljs-string">&#x27;1.0.1&#x27;</span>,<br>      params: &#123;<br>        ProductKey: <span class="hljs-built_in">this</span>.state.productKey,<br>        DeviceName: <span class="hljs-built_in">this</span>.state.deviceName<br>      &#125;<br>    &#125;).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (res.code !== <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(res.localizedMsg || res.message);<br>      &#125;<br>      <span class="hljs-keyword">let</span> props = &#123;&#125;;<br>      res.data.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>        props[item.attribute] = item.value;<br>      &#125;);<br>      <span class="hljs-keyword">if</span> (cb) &#123;<br>        cb(props);<br>      &#125;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;get props successfully:&#x27;</span>, props);<br>    &#125;);<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-title">setProps</span>(<span class="hljs-params">props</span>)</span> &#123;<br>    IotGateway.post(&#123;<br>      url: <span class="hljs-string">&#x27;https://api.link.aliyun.com/thing/device/properties/set&#x27;</span>,<br>      apiVer: <span class="hljs-string">&#x27;1.0.1&#x27;</span>,<br>      params: &#123;<br>        ThingId: &#123;<br>          productKey: <span class="hljs-built_in">this</span>.state.productKey,<br>          deviceName: <span class="hljs-built_in">this</span>.state.deviceName<br>        &#125;,<br>        Items: props<br>      &#125;<br>    &#125;).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (res.code !== <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(res.localizedMsg || res.message);<br>      &#125;<br>      <span class="hljs-built_in">console</span>.log(res);<br>    &#125;);<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-title">showValidationText</span>(<span class="hljs-params"></span>)</span> &#123;<br>    Dialog.alert(&#123;<br>      title: <span class="hljs-string">&#x27;提示&#x27;</span>,<br>      content: <span class="hljs-string">&#x27;请输入设备的 productKey 和 deviceName 才能控制设备哦&#x27;</span><br>    &#125;);<br>  &#125;<br>  onChange = <span class="hljs-function"><span class="hljs-params">checked</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.state.productKey || !<span class="hljs-built_in">this</span>.state.deviceName) &#123;<br>      <span class="hljs-built_in">this</span>.showValidationText();<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-built_in">this</span>.setState(&#123;<br>      <span class="hljs-keyword">switch</span>: checked<br>    &#125;);<br>    <span class="hljs-built_in">this</span>.setProps(&#123;<br>      LightSwitch: checked ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span><br>    &#125;);<br>  &#125;;<br>  onInput = <span class="hljs-function">(<span class="hljs-params">field, value</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">this</span>.state[field] = value;<br>    <span class="hljs-built_in">localStorage</span>.setItem(field, value);<br>    <span class="hljs-built_in">this</span>.setState(&#123;<br>      [field]: value<br>    &#125;);<br>  &#125;;<br>  onColorChange = <span class="hljs-function"><span class="hljs-params">color</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.state.productKey || !<span class="hljs-built_in">this</span>.state.deviceName) &#123;<br>      <span class="hljs-built_in">this</span>.showValidationText();<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-built_in">this</span>.setState(&#123;<br>      color: color.hex<br>    &#125;);<br>    <span class="hljs-built_in">this</span>.setProps(&#123;<br>      RGBColor: hexToRgb(color.hex)<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> &#123;<br>    <span class="hljs-keyword">return</span> (<br>      &lt;div style=&#123;&#123; <span class="hljs-attr">padding</span>: <span class="hljs-string">&#x27;30px 0 0 30px&#x27;</span> &#125;&#125;&gt;<br>        &lt;Form style=&#123;&#123; <span class="hljs-attr">margin</span>: <span class="hljs-string">&#x27;0 0 0 30px&#x27;</span> &#125;&#125; &#123;...formItemLayout&#125;&gt;<br>          &lt;FormItem label=<span class="hljs-string">&quot;设备 id&quot;</span>&gt;<br>            &lt;Row&gt;<br>              &lt;Col&gt;<br>                &lt;FormItem<br>                  label=<span class="hljs-string">&quot;productKey&quot;</span><br>                  required=&#123;<span class="hljs-literal">false</span>&#125;<br>                  labelAlign=<span class="hljs-string">&quot;inset&quot;</span><br>                  &#123;...insetLayout&#125;<br>                &gt;<br>                  &lt;Input<br>                    placeholder=<span class="hljs-string">&quot;请输入&quot;</span><br>                    value=&#123;<span class="hljs-built_in">this</span>.state.productKey&#125;<br>                    onChange=&#123;<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-built_in">this</span>.onInput(<span class="hljs-string">&#x27;productKey&#x27;</span>, value)&#125;<br>                  /&gt;<br>                &lt;/FormItem&gt;<br>              &lt;/Col&gt;<br>              &lt;Col&gt;<br>                &lt;FormItem<br>                  label=<span class="hljs-string">&quot;deviceName&quot;</span><br>                  required=&#123;<span class="hljs-literal">false</span>&#125;<br>                  labelAlign=<span class="hljs-string">&quot;inset&quot;</span><br>                  &#123;...insetLayout&#125;<br>                &gt;<br>                  &lt;Input<br>                    placeholder=<span class="hljs-string">&quot;请输入&quot;</span><br>                    value=&#123;<span class="hljs-built_in">this</span>.state.deviceName&#125;<br>                    onChange=&#123;<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-built_in">this</span>.onInput(<span class="hljs-string">&#x27;deviceName&#x27;</span>, value)&#125;<br>                  /&gt;<br>                &lt;/FormItem&gt;<br>              &lt;/Col&gt;<br>            &lt;/Row&gt;<br>          &lt;/FormItem&gt;<br>          &lt;FormItem label=<span class="hljs-string">&quot;开关&quot;</span>&gt;<br>            &lt;Switch onChange=&#123;<span class="hljs-built_in">this</span>.onChange&#125; checked=&#123;<span class="hljs-built_in">this</span>.state.switch&#125; /&gt;<br>          &lt;/FormItem&gt;<br>          &lt;FormItem label=<span class="hljs-string">&quot;调色&quot;</span>&gt;<br>            &lt;div style=&#123;&#123; <span class="hljs-attr">padding</span>: <span class="hljs-string">&#x27;7px 0 0 10px&#x27;</span> &#125;&#125;&gt;<br>              &lt;HuePicker<br>                onChangeComplete=&#123;<span class="hljs-built_in">this</span>.onColorChange&#125;<br>                color=&#123;<span class="hljs-built_in">this</span>.state.color&#125;<br>              /&gt;<br>            &lt;/div&gt;<br>          &lt;/FormItem&gt;<br>        &lt;/Form&gt;<br>      &lt;/div&gt;<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rgbToHex</span>(<span class="hljs-params">r, g, b</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;#&#x27;</span> + ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">24</span>) + (r &lt;&lt; <span class="hljs-number">16</span>) + (g &lt;&lt; <span class="hljs-number">8</span>) + b).toString(<span class="hljs-number">16</span>).slice(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hexToRgb</span>(<span class="hljs-params">hex</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> result = <span class="hljs-regexp">/^#?([a-f\d]&#123;2&#125;)([a-f\d]&#123;2&#125;)([a-f\d]&#123;2&#125;)$/i</span>.exec(hex);<br>  <span class="hljs-keyword">return</span> result<br>    ? &#123;<br>        Red: <span class="hljs-built_in">parseInt</span>(result[<span class="hljs-number">1</span>], <span class="hljs-number">16</span>),<br>        Green: <span class="hljs-built_in">parseInt</span>(result[<span class="hljs-number">2</span>], <span class="hljs-number">16</span>),<br>        Blue: <span class="hljs-built_in">parseInt</span>(result[<span class="hljs-number">3</span>], <span class="hljs-number">16</span>)<br>      &#125;<br>    : <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>运行调试</strong><br>启动项目</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">bone <span class="hljs-literal">start</span><br></code></pre></td></tr></table></figure>
<p><img src="/img/LD22.png" srcset="/img/loading.gif" lazyload alt="img"><br>使用 Chrome 浏览器访问：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8000</span>/<br></code></pre></td></tr></table></figure>
<p>这时候页面会提示输入应用的 appKey 和 appSecret，从平台上复制过来填好，点击“确认”按钮。<br><img src="/img/LD23.png" srcset="/img/loading.gif" lazyload alt="img"><br>我们要在 Web 应用上控制一台设备，得知道它的唯一标识（设备id），云端才能找到对应的设备进行操作。</p>
<p>设备的唯一标识就是刚才创建的测试设备激活凭证中的 productKey 和 deviceName 两个字段。有了这两个字段，云端就可以找到我们的刚才开发的那台设备。</p>
<p>将测试设备激活凭证中的 productKey + deviceName 填入 Web 界面输入框中：<br><img src="/img/LD24.png" srcset="/img/loading.gif" lazyload alt="img"><br>接着我们刷新一下页面，查看一下 Chrome 浏览器控制台（按 F12 或者 Ctrl+Shift+i），发现设备的属性已经能正常获取了。<br><img src="/img/LD25.png" srcset="/img/loading.gif" lazyload alt="img"><br>点击“设置属性”按钮，待页面刷新后，观察测试设备的日志接收情况，这里以 Web Device 模拟设备为例，可以看到 Web Device 模拟设备成功接收到到云端设置属性的消息：<br><img src="/img/LD26.png" srcset="/img/loading.gif" lazyload alt="img"><br>将模拟设备的 RGBColor 属性值改成（255,255,0），点击“上报”，在右侧可以看到设备上报属性成功的消息：<br><img src="/img/LD27.png" srcset="/img/loading.gif" lazyload alt="img"><br>这时候我们再刷新应用页面，发现页面也加载到了最新上报的属性值。</p>
<p>至此，RGB 全彩智能灯的 Web 应用也完毕！</p>
<p><strong>应用发布</strong><br>由于该功能善未完全实现，将在之后补出</p>
<p>上面内容大都为搬运官方文档，下面是一张个人总结的简单流程图</p>
<p><img src="/img/LD28.png" srcset="/img/loading.gif" lazyload alt="img"></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E9%98%BF%E9%87%8C/">阿里</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2018/07/22/2018-07-22-mybatis/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Mybatis 批量更新</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2018/06/05/2018-06-05-modal/">
                        <span class="hidden-mobile">Bootstrap的模态框案例</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
